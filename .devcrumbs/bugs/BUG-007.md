# Flat View: Expanded State Resets on Toggle - REAL FIX

## Root Cause Analysis

**Previous attempt failed** because `treeView.reveal()` doesn't reliably work.

**Real problem:** TypeGroupNode.toTreeItem() always returns `TreeItemCollapsibleState.Collapsed` (line 131).

```typescript
toTreeItem(): vscode.TreeItem {
  const item = new vscode.TreeItem(
    `${this.type.toUpperCase()}S (${this.count})`,
    vscode.TreeItemCollapsibleState.Collapsed, // ← ALWAYS COLLAPSED!
  );
```

## Correct Solution

TypeGroupNode needs to **receive expanded state** from provider and use it in toTreeItem():

```typescript
class TypeGroupNode extends TreeNode {
  constructor(
    private type: string,
    private count: number,
    private items: WorkItem[],
    private isExpanded: boolean = false // ← ADD THIS
  ) {
    super();
  }

  toTreeItem(): vscode.TreeItem {
    const collapsibleState = this.isExpanded 
      ? vscode.TreeItemCollapsibleState.Expanded
      : vscode.TreeItemCollapsibleState.Collapsed;
    
    const item = new vscode.TreeItem(
      `${this.type.toUpperCase()}S (${this.count})`,
      collapsibleState // ← USE DYNAMIC STATE
    );
```

Provider passes expanded state when creating nodes:

```typescript
// In getFlatRootNodes()
return Object.entries(typeGroups)
  .map(([type, items]) => {
    const isExpanded = this.expandedGroups.has(type);
    return new TypeGroupNode(type, items.length, items, isExpanded);
  });
```

This way VS Code TreeView automatically honors the collapsible state!