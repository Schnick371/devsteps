# Problem

Published npm package `@schnick371/devsteps-mcp-server@0.8.1-next.6` has broken dependency declaration.

## Evidence

```bash
npm view @schnick371/devsteps-mcp-server@next dependencies
# Shows: '@schnick371/devsteps-shared': 'file:../shared'
```

When npm installs the package via `npx`, it tries to resolve `file:../shared` which doesn't exist outside the monorepo, causing:

```
Cannot find package '@schnick371/devsteps-shared' imported from 
/home/th/.npm/_npx/.../node_modules/@schnick371/devsteps-mcp-server/dist/handlers/status.js
```

## Root Cause

Monorepo workspace dependencies are declared as `file:../shared` in package.json for local development, but this MUST be changed to proper npm version before publishing.

## Impact

- ✅ Extension 0.8.2 correctly detects pre-release and requests @next
- ✅ npm downloads 0.8.1-next.6 successfully  
- ❌ MCP server crashes immediately - shared package not found
- ❌ **Blocks ALL MCP functionality**

## Solution

Change dependency in `packages/mcp-server/package.json`:

```json
"dependencies": {
  "@schnick371/devsteps-shared": "0.8.1-next.6",  // NOT "file:../shared"
  ...
}
```

Must do this BEFORE `npm publish`!

## Validation

After fix:
1. Build locally
2. `npm pack` and inspect tarball
3. Extract and check node_modules after install
4. Verify shared package is installed as real npm package

## Prevention

- Add pre-publish script to validate dependencies
- Never publish with `file:` dependencies
- Consider using `npm pack` + local install test before publishing

## Testing Answer: Pre-Release Detection

**Question:** "Wie wird sichergestellt, dass die extension erkennt das es ein prerelease ist?"

**Answer:** ✅ **WORKS PERFECTLY NOW!**

1. Extension 0.8.2 has `"preRelease": true` in package.json
2. Code reads `context.extension.packageJSON.preRelease` 
3. Selects `@schnick371/devsteps-mcp-server@next` when true
4. npm successfully downloads 0.8.1-next.6

**Evidence from Testing:**
- Before reload: MCP used 0.6.14 (@latest) - looked for index.json
- After installing 0.8.2 + reload: MCP downloads 0.8.1-next.6 - tries refs-style index
- Error changed from "ENOENT: index.json" to "Cannot find shared package"
- **This proves version detection works!**

The only remaining issue is the broken dependency (BUG-049), NOT the pre-release detection (TASK-207 ✅).
