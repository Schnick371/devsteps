# Remaining CLI/MCP commands reference deprecated index.json

## Problem

After the index.json → index/ directory migration, several commands still attempt to read the old monolithic `index.json` file, causing "ENOENT" errors.

## Migrated Commands ✅

**MCP Handlers:**
- status.ts - Uses listItems()
- search.ts - Updated paths to items/ subdirectory  
- export.ts - Uses listItems() and calculates stats

**CLI Commands:**
- status - Uses listItems()
- list - Uses listItems()

## Still Broken ❌

**CLI Commands:**
- `update` - Lines 270-290 read index.json
- `trace` - Unknown usage
- `context` - Line 138 reads index.json
- `doctor` - Line 156 reads index.json

**MCP Handlers:**
- `add.ts` - Creates items but updates index.json
- `update.ts` - Updates index.json
- `init.ts` - Creates index.json for new projects

## Impact

Users cannot:
- Update existing items (status changes, title edits)
- Create new items  
- Trace dependencies
- Initialize new projects
- Run diagnostics

## Solution

1. Migrate `add` and `update` handlers to use index-refs write operations
2. Migrate CLI update/trace/context/doctor to use listItems()
3. Update init.ts to create index/ structure instead of index.json
4. Test all commands end-to-end

## Related

This bug was discovered immediately after merging index/ migration (STORY-079, EPIC-020).
