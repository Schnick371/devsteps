# Bug: updateItem Crashes on Legacy Item Format

## Problem
Items created with the old schema format use `links` (with underscore notation) instead of `linked_items` (with hyphenated keys). When `updateItem` processes such items, it throws:
```
Cannot read properties of undefined (reading 'implemented-by')
```

This makes it impossible to update status or any other field on legacy-format items via both CLI and MCP tools.

## Reproduction
1. Find an item with `links` property instead of `linked_items` (e.g., old BUG-038)
2. Run: `node packages/cli/dist/index.js update <ID> --status done`
3. Error: `Cannot read properties of undefined (reading 'implemented-by')`

## Root Cause
`updateItem()` in shared package reads `item.linked_items['implemented-by']` as part of index-refs update. Old-format items have `links.implemented_by` instead. The auto-migration guard didn't cover this code path.

## Fix
In `updateItem()` or the calling code, add guard:
```typescript
if (!item.linked_items) {
  // Trigger auto-migration before updating
  await ensureFullMigration(devstepsDir);
  // Reload item after migration
}
```
Or normalize `links` â†’ `linked_items` on `getItem()` load in auto-migrate.

## Impact
- Any item created before linked_items schema migration is read-only (cannot be updated)
- Workaround: Archive the item (archiveItem side-steps the linked_items check)