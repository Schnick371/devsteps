# Remaining CLI/MCP commands reference deprecated index.json

## Problem

After the index.json → index/ directory migration, several commands still attempt to read the old monolithic `index.json` file, causing "ENOENT" errors.

## Migrated Commands ✅

**MCP Handlers:**
- status.ts - Uses listItems()
- search.ts - Updated paths to items/ subdirectory  
- export.ts - Uses listItems() and calculates stats

**CLI Commands:**
- status - Uses listItems()
- list - Uses listItems()

## Still Broken ❌

**Shared Package (CRITICAL):**
- `archive.ts` - Line 87-88: `purgeItems()` reads index.json

**CLI Commands:**
- `update` - Lines 270-290 read index.json
- `trace` - Unknown usage
- `context` - Line 138 reads index.json
- `doctor` - Line 156 reads index.json
- `purge` - Calls broken `purgeItems()` from shared package

**MCP Handlers:**
- `add.ts` - Creates items but updates index.json
- `update.ts` - Updates index.json
- `init.ts` - Creates index.json for new projects
- `purge.ts` - Calls broken `purgeItems()` from shared package

## Impact

Users cannot:
- **Purge/bulk archive items** (CLI `devsteps purge`, MCP `#mcp_devsteps_purge`)
- Update existing items (status changes, title edits)
- Create new items  
- Trace dependencies
- Initialize new projects
- Run diagnostics

## Solution

**Priority 1 (Shared Package):**
1. Fix `purgeItems()` in `packages/shared/src/core/archive.ts` to use `listItems()` instead of reading index.json

**Priority 2 (Consumers):**
2. Migrate `add` and `update` handlers to use index-refs write operations
3. Migrate CLI update/trace/context/doctor to use listItems()
4. Update init.ts to create index/ structure instead of index.json
5. Test all commands end-to-end

## Related

This bug was discovered immediately after merging index/ migration (STORY-079, EPIC-020).

**Evidence:** User report - `#mcp_devsteps_purge` returns ENOENT error for index.json
