# TreeView Menu Missing in VSIX - Context Key Race Condition

## Problem

**Symptom:** "View & Sort" submenu (with Hierarchical/Flat toggle) is **missing** in installed VSIX but works perfectly in debug runtime.

**Impact:** Critical UX bug - users cannot switch between hierarchical and flat view modes.

## Root Cause Analysis

### Race Condition in Context Key Initialization

The submenu visibility depends on `devsteps.viewMode` context key.

**Current initialization sequence:**
1. Extension activates
2. TreeView created
3. `await treeDataProvider.initialize()` - **ASYNC!**
4. Context keys set (line 187-190)

**Problem:** VS Code renders UI BEFORE step 4 completes!

### Why Debug Works

In debug mode:
- Slower startup
- More time between TreeView creation and rendering
- Context keys always set before UI appears

### Why Production Fails

In installed VSIX:
- Faster startup (optimized bundle)
- UI renders immediately
- Context keys not set yet → menu items evaluate to false → submenu hidden

## Solution

Set context keys **BEFORE** creating TreeView, using state manager defaults.

## Affected Code

`packages/extension/src/extension.ts` (lines 150-195)

## Reproduction

1. Build VSIX: `npm run package`
2. Install VSIX in VS Code
3. Open workspace with `.devsteps/`
4. Observe: TreeView toolbar shows only buttons, no "..." menu
5. Compare with debug runtime (F5) - menu appears correctly