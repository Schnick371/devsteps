# Context Keys Synchronisation Bug

## Problem
Nach TASK-037 Implementation: **State wird korrekt persistiert und geladen**, aber **Context Keys zeigen falsche Werte**.

**Symptome:**
- TreeView zeigt "Scrum Hierarchy Only" (korrekt persistiert)
- Menu zeigt "$(check) Show Both Hierarchies" (falsch - zeigt Default)
- Hide Done ist aktiv in TreeView aber Menu zeigt "nicht aktiv"

## Root Cause
Context Keys werden mit **statischen Defaults** überschrieben statt mit **geladenen State** synchronisiert:

```typescript
// extension.ts:127 - FALSCH!
await vscode.commands.executeCommand('setContext', 'devsteps.viewMode', 'flat');
await vscode.commands.executeCommand('setContext', 'devsteps.hierarchy', 'both');  
await vscode.commands.executeCommand('setContext', 'devsteps.hideDone', false);
```

**Korrekte Reihenfolge sollte sein:**
1. StateManager lädt persisted state
2. Context Keys werden mit actual state synchronisiert
3. Menu zeigt korrekte Checkmarks

## User Impact
- Verwirrung: Menu zeigt falschen aktuellen Zustand
- Vertrauen verloren in State-Persistence
- Inkonsistente UX zwischen TreeView und Menu-Feedback

## Technical Details
- Context Keys steuern `when` clauses in package.json für Menu-Checkmarks
- `devsteps.viewMode == 'hierarchical'` zeigt hierarchical.active command
- `devsteps.hierarchy == 'scrum'` zeigt scrum.active command
- `devsteps.hideDone == true` zeigt hideDone.active command

## Research Findings
VS Code Best Practices 2025:
- Context Keys müssen nach State-Load explizit synchronisiert werden
- Extension Activation: Load State → Set Context Keys → UI Render
- StateManager provides getters for current state

## Solution
Nach StateManager-Load in extension.ts:
```typescript
// Get actual loaded state
const actualViewMode = treeDataProvider.getViewMode();
const actualHierarchy = treeDataProvider.getHierarchyType(); 
const actualHideDone = treeDataProvider.getHideDoneState();

// Sync context keys with actual state
await vscode.commands.executeCommand('setContext', 'devsteps.viewMode', actualViewMode);
await vscode.commands.executeCommand('setContext', 'devsteps.hierarchy', actualHierarchy);
await vscode.commands.executeCommand('setContext', 'devsteps.hideDone', actualHideDone);
```